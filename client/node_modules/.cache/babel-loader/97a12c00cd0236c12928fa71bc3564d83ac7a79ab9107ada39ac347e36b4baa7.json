{"ast":null,"code":"import _objectSpread from\"C:/Users/a/Documents/New folder (3)/mern-social-media-master/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useRef}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{POST_TYPES}from\"./redux/actions/postAction\";import{ADMIN_TYPES}from\"./redux/actions/adminAction\";import{GLOBALTYPES}from\"./redux/actions/globalTypes\";import{NOTIFY_TYPES}from\"./redux/actions/notifyAction\";import{MESSAGE_TYPES}from\"./redux/actions/messageAction\";import audioTone from'./audio/pristine-609.mp3';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var spawnNotification=function spawnNotification(body,icon,url,title){var options={body:body,icon:icon};var n=new Notification(title,options);n.onclick=function(e){e.preventDefault();window.open(url,'_blank');};};var SocketClient=function SocketClient(){var _useSelector=useSelector(function(state){return state;}),auth=_useSelector.auth,socket=_useSelector.socket,notify=_useSelector.notify;var dispatch=useDispatch();var audioRef=useRef();//!connection\nuseEffect(function(){if(auth.user.role===\"user\"){socket.emit(\"joinUser\",auth.user._id);}else if(auth.user.role===\"admin\"){socket.emit(\"joinAdmin\",auth.user._id);}},[socket,auth.user.role,auth.user._id]);useEffect(function(){socket.on(\"getActiveUsersToClient\",function(totalActiveUsers){dispatch({type:ADMIN_TYPES.GET_TOTAL_ACTIVE_USERS,payload:totalActiveUsers});});return function(){return socket.off(\"getActiveUsersToClient\");};},[socket,dispatch]);//!like Post\nuseEffect(function(){socket.on(\"likeToClient\",function(newPost){dispatch({type:POST_TYPES.UPDATE_POST,payload:newPost});});return function(){return socket.off(\"likeToClient\");};},[socket,dispatch]);//!Unlike Post\nuseEffect(function(){socket.on(\"unLikeToClient\",function(newPost){dispatch({type:POST_TYPES.UPDATE_POST,payload:newPost});});return function(){return socket.off(\"unLikeToClient\");};},[socket,dispatch]);//!Comments\nuseEffect(function(){socket.on(\"createCommentToClient\",function(newPost){dispatch({type:POST_TYPES.UPDATE_POST,payload:newPost});});return function(){return socket.off(\"createCommentToClient\");};},[socket,dispatch]);useEffect(function(){socket.on(\"deleteCommentToClient\",function(newPost){dispatch({type:POST_TYPES.UPDATE_POST,payload:newPost});});return function(){return socket.off(\"deleteCommentToClient\");};},[socket,dispatch]);//!Follow\nuseEffect(function(){socket.on(\"followToClient\",function(newUser){dispatch({type:GLOBALTYPES.AUTH,payload:_objectSpread(_objectSpread({},auth),{},{user:newUser})});});return function(){return socket.off(\"followToClient\");};},[socket,dispatch,auth]);useEffect(function(){socket.on(\"unFollowToClient\",function(newUser){dispatch({type:GLOBALTYPES.AUTH,payload:_objectSpread(_objectSpread({},auth),{},{user:newUser})});});return function(){return socket.off(\"unFollowToClient\");};},[socket,dispatch,auth]);//!Notifications\nuseEffect(function(){socket.on(\"createNotifyToClient\",function(msg){dispatch({type:NOTIFY_TYPES.CREATE_NOTIFY,payload:msg});if(notify.sound){audioRef.current.play();}spawnNotification(msg.user.username+\" \"+msg.text,msg.user.avatar,msg.url,\"CAMPUS CONNECT\");});return function(){return socket.off(\"createNotifyToClient\");};},[socket,dispatch,notify.sound]);useEffect(function(){socket.on(\"removeNotifyToClient\",function(msg){dispatch({type:NOTIFY_TYPES.REMOVE_NOTIFY,payload:msg});});return function(){return socket.off(\"removeNotifyToClient\");};},[socket,dispatch]);//!Messages\nuseEffect(function(){socket.on(\"addMessageToClient\",function(msg){dispatch({type:MESSAGE_TYPES.ADD_MESSAGE,payload:msg});});return function(){return socket.off(\"addMessageToClient\");};},[]);return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"audio\",{controls:true,ref:audioRef,style:{display:\"none\"},children:/*#__PURE__*/_jsx(\"source\",{src:audioTone,type:\"audio/mp3\"})})});};export default SocketClient;","map":{"version":3,"names":["React","useEffect","useRef","useDispatch","useSelector","POST_TYPES","ADMIN_TYPES","GLOBALTYPES","NOTIFY_TYPES","MESSAGE_TYPES","audioTone","jsx","_jsx","Fragment","_Fragment","spawnNotification","body","icon","url","title","options","n","Notification","onclick","e","preventDefault","window","open","SocketClient","_useSelector","state","auth","socket","notify","dispatch","audioRef","user","role","emit","_id","on","totalActiveUsers","type","GET_TOTAL_ACTIVE_USERS","payload","off","newPost","UPDATE_POST","newUser","AUTH","_objectSpread","msg","CREATE_NOTIFY","sound","current","play","username","text","avatar","REMOVE_NOTIFY","ADD_MESSAGE","children","controls","ref","style","display","src"],"sources":["C:/Users/a/Documents/New folder (3)/mern-social-media-master/client/src/SocketClient.js"],"sourcesContent":["import React, { useEffect, useRef } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { POST_TYPES } from \"./redux/actions/postAction\";\r\nimport { ADMIN_TYPES } from \"./redux/actions/adminAction\";\r\nimport { GLOBALTYPES } from \"./redux/actions/globalTypes\";\r\nimport { NOTIFY_TYPES } from \"./redux/actions/notifyAction\";\r\nimport { MESSAGE_TYPES } from \"./redux/actions/messageAction\";\r\n\r\nimport audioTone from './audio/pristine-609.mp3' \r\n\r\nconst spawnNotification = (body, icon, url, title) => {\r\n  let options = {\r\n    body, icon\r\n  }\r\n  let n = new Notification(title, options);\r\n  n.onclick =  e => {\r\n    e.preventDefault();\r\n    window.open(url, '_blank');\r\n  }\r\n}\r\n\r\nconst SocketClient = () => {\r\n  const { auth, socket, notify } = useSelector((state) => state);\r\n  const dispatch = useDispatch();\r\n\r\n  const audioRef = useRef();\r\n\r\n  //!connection\r\n  useEffect(() => {\r\n    if (auth.user.role === \"user\") {\r\n      socket.emit(\"joinUser\", auth.user._id);\r\n    } else if (auth.user.role === \"admin\") {\r\n      socket.emit(\"joinAdmin\", auth.user._id);\r\n    }\r\n  }, [socket, auth.user.role, auth.user._id]);\r\n\r\n  useEffect(() => {\r\n    socket.on(\"getActiveUsersToClient\", (totalActiveUsers) => {\r\n      dispatch({\r\n        type: ADMIN_TYPES.GET_TOTAL_ACTIVE_USERS,\r\n        payload: totalActiveUsers,\r\n      });\r\n    });\r\n    return () => socket.off(\"getActiveUsersToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  //!like Post\r\n  useEffect(() => {\r\n    socket.on(\"likeToClient\", (newPost) => {\r\n      dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost });\r\n    });\r\n    return () => socket.off(\"likeToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  //!Unlike Post\r\n  useEffect(() => {\r\n    socket.on(\"unLikeToClient\", (newPost) => {\r\n      dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost });\r\n    });\r\n    return () => socket.off(\"unLikeToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  //!Comments\r\n  useEffect(() => {\r\n    socket.on(\"createCommentToClient\", (newPost) => {\r\n      dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost });\r\n    });\r\n    return () => socket.off(\"createCommentToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  useEffect(() => {\r\n    socket.on(\"deleteCommentToClient\", (newPost) => {\r\n      dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost });\r\n    });\r\n    return () => socket.off(\"deleteCommentToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  //!Follow\r\n  useEffect(() => {\r\n    socket.on(\"followToClient\", (newUser) => {\r\n      dispatch({ type: GLOBALTYPES.AUTH, payload: { ...auth, user: newUser } });\r\n    });\r\n    return () => socket.off(\"followToClient\");\r\n  }, [socket, dispatch, auth]);\r\n\r\n  useEffect(() => {\r\n    socket.on(\"unFollowToClient\", (newUser) => {\r\n      dispatch({\r\n        type: GLOBALTYPES.AUTH,\r\n        payload: { ...auth, user: newUser },\r\n      });\r\n    });\r\n    return () => socket.off(\"unFollowToClient\");\r\n  }, [socket, dispatch, auth]);\r\n\r\n  //!Notifications\r\n  useEffect(() => {\r\n    socket.on(\"createNotifyToClient\", (msg) => {\r\n      dispatch({ type: NOTIFY_TYPES.CREATE_NOTIFY, payload: msg });\r\n\r\n      if (notify.sound) {\r\n        audioRef.current.play();\r\n      }\r\n      spawnNotification(\r\n        msg.user.username + \" \" + msg.text,\r\n        msg.user.avatar,\r\n        msg.url,\r\n        \"CAMPUS CONNECT\"\r\n      );\r\n    });\r\n    return () => socket.off(\"createNotifyToClient\");\r\n  }, [socket, dispatch, notify.sound]);\r\n\r\n  useEffect(() => {\r\n    socket.on(\"removeNotifyToClient\", (msg) => {\r\n      dispatch({ type: NOTIFY_TYPES.REMOVE_NOTIFY, payload: msg });\r\n    });\r\n    return () => socket.off(\"removeNotifyToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  //!Messages\r\n  useEffect(() => {\r\n    socket.on(\"addMessageToClient\", (msg) => {\r\n      dispatch({ type: MESSAGE_TYPES.ADD_MESSAGE, payload: msg });\r\n\r\n    });\r\n    return () => socket.off(\"addMessageToClient\");\r\n  }, []);\r\n\r\n  return (\r\n    <>\r\n      <audio controls ref={audioRef} style={{ display: \"none\" }}>\r\n        <source src={audioTone} type=\"audio/mp3\" />\r\n      </audio>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default SocketClient;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}