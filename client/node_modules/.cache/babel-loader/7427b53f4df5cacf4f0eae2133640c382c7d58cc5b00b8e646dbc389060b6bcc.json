{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/a/Documents/New folder (3)/mern-social-media-master/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/a/Documents/New folder (3)/mern-social-media-master/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/a/Documents/New folder (3)/mern-social-media-master/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect,useRef}from'react';import{useDispatch,useSelector}from'react-redux';import{useHistory,useParams}from'react-router-dom';import{GLOBALTYPES}from'../../redux/actions/globalTypes';import{addUser,getConversations}from\"../../redux/actions/messageAction\";import{getDataAPI}from'../../utils/fetchData';import UserCard from\"../UserCard\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var LeftSide=function LeftSide(){var _useSelector=useSelector(function(state){return state;}),auth=_useSelector.auth,message=_useSelector.message;var dispatch=useDispatch();var history=useHistory();var _useParams=useParams(),id=_useParams.id;var pageEnd=useRef();var _useState=useState(0),_useState2=_slicedToArray(_useState,2),page=_useState2[0],setPage=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),search=_useState4[0],setSearch=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),searchUsers=_useState6[0],setSearchUsers=_useState6[1];var handleSearch=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var res;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:e.preventDefault();if(search){_context.next=3;break;}return _context.abrupt(\"return\",setSearchUsers([]));case 3:_context.prev=3;_context.next=6;return getDataAPI(\"search?username=\".concat(search),auth.token);case 6:res=_context.sent;setSearchUsers(res.data.users);_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](3);dispatch({type:GLOBALTYPES.ALERT,payload:{error:_context.t0.response.data.msg}});case 13:case\"end\":return _context.stop();}},_callee,null,[[3,10]]);}));return function handleSearch(_x){return _ref.apply(this,arguments);};}();var handleAddUser=function handleAddUser(user){setSearch('');setSearchUsers([]);dispatch(addUser({user:user,message:message}));return history.push(\"/message/\".concat(user._id));};var isActive=function isActive(user){if(id===user._id)return'active';return'';};useEffect(function(){if(message.firstLoad)return;dispatch(getConversations({auth:auth}));},[dispatch,auth,message.firstLoad]);useEffect(function(){var observer=new IntersectionObserver(function(entries){if(entries[0].isIntersecting){setPage(function(p){return p+1;});}},{threshold:0.1});observer.observe(pageEnd.current);},[setPage]);useEffect(function(){if(message.resultUsers>=(page-1)*9&&page>1){dispatch(getConversations({auth:auth,page:page}));}},[message.resultUsers,page,auth,dispatch]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"form\",{className:\"message_header\",onSubmit:handleSearch,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:search,onChange:function onChange(e){return setSearch(e.target.value);},placeholder:\"search...\"}),/*#__PURE__*/_jsx(\"button\",{style:{display:\"none\"},type:\"submit\",id:\"search\",children:\"Search\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"message_chat_list\",children:[searchUsers.length!==0?/*#__PURE__*/_jsx(_Fragment,{children:searchUsers.map(function(user){return/*#__PURE__*/_jsx(\"div\",{className:\"message_user \".concat(isActive(user)),onClick:function onClick(){return handleAddUser(user);},children:/*#__PURE__*/_jsx(UserCard,{user:user})},user._id);})}):/*#__PURE__*/_jsx(_Fragment,{children:message.users.map(function(user){return/*#__PURE__*/_jsx(\"div\",{cclassName:\"message_user \".concat(isActive(user)),onClick:function onClick(){return handleAddUser(user);},children:/*#__PURE__*/_jsx(UserCard,{user:user,msg:true,children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-circle\"})})},user._id);})}),/*#__PURE__*/_jsx(\"button\",{style:{opacity:0},ref:pageEnd,children:\"Load more..\"})]})]});};export default LeftSide;","map":{"version":3,"names":["React","useState","useEffect","useRef","useDispatch","useSelector","useHistory","useParams","GLOBALTYPES","addUser","getConversations","getDataAPI","UserCard","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","LeftSide","_useSelector","state","auth","message","dispatch","history","_useParams","id","pageEnd","_useState","_useState2","_slicedToArray","page","setPage","_useState3","_useState4","search","setSearch","_useState5","_useState6","searchUsers","setSearchUsers","handleSearch","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","e","res","wrap","_callee$","_context","prev","next","preventDefault","abrupt","concat","token","sent","data","users","t0","type","ALERT","payload","error","response","msg","stop","_x","apply","arguments","handleAddUser","user","push","_id","isActive","firstLoad","observer","IntersectionObserver","entries","isIntersecting","p","threshold","observe","current","resultUsers","children","className","onSubmit","value","onChange","target","placeholder","style","display","length","map","onClick","cclassName","opacity","ref"],"sources":["C:/Users/a/Documents/New folder (3)/mern-social-media-master/client/src/components/message/LeftSide.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { useHistory, useParams } from 'react-router-dom';\r\nimport { GLOBALTYPES } from '../../redux/actions/globalTypes';\r\nimport { addUser, getConversations } from \"../../redux/actions/messageAction\";\r\nimport { getDataAPI } from '../../utils/fetchData';\r\nimport UserCard from \"../UserCard\";\r\n\r\nconst LeftSide = () => {\r\n    const { auth, message } = useSelector((state) => state);\r\n    const dispatch = useDispatch();\r\n    const history = useHistory();\r\n    const { id } = useParams();\r\n    const pageEnd = useRef();\r\n    const [page, setPage] = useState(0);\r\n\r\n    const [search, setSearch] = useState('');\r\n    const [searchUsers, setSearchUsers] = useState([]);\r\n\r\n    const handleSearch = async e => {\r\n        e.preventDefault();\r\n        if (!search) return setSearchUsers([]);\r\n\r\n    try {\r\n      const res = await getDataAPI(`search?username=${search}`, auth.token);\r\n      setSearchUsers(res.data.users);\r\n    } catch (err) {\r\n      dispatch({\r\n        type: GLOBALTYPES.ALERT,\r\n        payload: { error: err.response.data.msg },\r\n      });\r\n    }\r\n    };\r\n\r\n    const handleAddUser = (user) => {\r\n        setSearch('');\r\n        setSearchUsers([]);\r\n        dispatch(addUser({user, message}));\r\n        return history.push(`/message/${user._id}`);\r\n    };\r\n\r\n    const isActive = (user) => {\r\n      if(id === user._id) return 'active';\r\n      return '';\r\n    }\r\n\r\n    useEffect(() => {\r\n      if (message.firstLoad) return;\r\n      dispatch(getConversations({ auth }));\r\n    }, [dispatch, auth, message.firstLoad]);\r\n\r\n     useEffect(() => {\r\n       const observer = new IntersectionObserver(\r\n         (entries) => {\r\n           if (entries[0].isIntersecting) {\r\n             setPage((p) => p + 1);\r\n           }\r\n         },\r\n         {\r\n           threshold: 0.1,\r\n         }\r\n       );\r\n       observer.observe(pageEnd.current);\r\n     }, [setPage]);\r\n\r\n     useEffect(() => {\r\n       if (message.resultUsers >= (page - 1) * 9 && page > 1) {\r\n         dispatch(getConversations({ auth, page }));\r\n       }\r\n     }, [message.resultUsers, page, auth, dispatch]);\r\n\r\n    return (\r\n      <>\r\n        <form className=\"message_header\" onSubmit={handleSearch}>\r\n          <input\r\n            type=\"text\"\r\n            value={search}\r\n            onChange={(e) => setSearch(e.target.value)}\r\n            placeholder=\"search...\"\r\n          />\r\n\r\n          <button style={{ display: \"none\" }} type=\"submit\" id=\"search\">\r\n            Search\r\n          </button>\r\n        </form>\r\n\r\n        <div className=\"message_chat_list\">\r\n          {searchUsers.length !== 0 ? (\r\n            <>\r\n              {searchUsers.map((user) => (\r\n                <div\r\n                  key={user._id}\r\n                  className={`message_user ${isActive(user)}`}\r\n                  onClick={() => handleAddUser(user)}\r\n                >\r\n                  <UserCard user={user} />\r\n                </div>\r\n              ))}\r\n            </>\r\n          ) : (\r\n            <>\r\n              {message.users.map((user) => (\r\n                <div\r\n                  key={user._id}\r\n                  cclassName={`message_user ${isActive(user)}`}\r\n                  onClick={() => handleAddUser(user)}\r\n                >\r\n                  <UserCard user={user} msg={true}>\r\n                    <i className=\"fas fa-circle\" />\r\n                  </UserCard>\r\n                </div>\r\n              ))}\r\n            </>\r\n          )}\r\n\r\n          <button style={{opacity: 0}} ref={pageEnd}>Load more..</button>\r\n        </div>\r\n      </>\r\n    );\r\n}\r\n\r\nexport default LeftSide\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}